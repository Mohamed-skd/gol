import{FetchFn,NumberFn}from"./scripts/lib.js";import{DomFn}from"./scripts/client.js";let domFn=new DomFn,fetchFn=new FetchFn,numFn=new NumberFn,select=domFn.select("aside > select"),button=domFn.select("aside > button"),canvas=domFn.select("canvas"),ctxt=canvas.getContext("2d"),gridSize=100,width=canvas.width,height=canvas.height,cellWidth=width/gridSize,cellHeight=height/gridSize,schemas=await fetchFn.get(null,"json",location.href+"assets/GameSchemas.json"),{blinker,cross,galaxy,glider,LWSS}=schemas,all=[...blinker,...cross,...galaxy,...glider,...LWSS],state,startTime;function initState(t=[]){state=[];for(let e=0;e<gridSize;e++){state[e]=[];for(let t=0;t<gridSize;t++)state[e][t]=!1}t.forEach(t=>{state[t[1]][t[0]]=!0})}function getNbrs(a,n){var l,s,i=[];for(let e=a-1;e<a+2;e++)for(let t=n-1;t<n+2;t++)a===e&&n===t||(l=numFn.loop(e,0,gridSize-1),s=numFn.loop(t,0,gridSize-1),i.push(state[l][s]));return i}function nextState(){var a=[];for(let e=0;e<state.length;e++){a[e]=[];for(let t=0;t<state.length;t++)switch(a[e][t]=state[e][t],getNbrs(e,t).filter(t=>t).length){case 3:a[e][t]=!0;break;case 2:break;default:a[e][t]=!1}}state=a}function clearCanvas(){var t=Math.max(width,height);ctxt.clearRect(-10,-10,t+20,t+20)}function drawCell(t,e,a=[120,100,50]){a=`hsl(${a[0]}, ${a[1]}%, ${a[2]}%)`;ctxt.beginPath(),ctxt.fillStyle=a,ctxt.rect(t*cellWidth,e*cellHeight,cellWidth,cellHeight),ctxt.fill(),ctxt.closePath()}function loop(t){if(startTime){if(!(t<startTime+160)){startTime=t,clearCanvas();for(let e=0;e<state.length;e++)for(let t=0;t<state.length;t++)state[e][t]&&drawCell(t,e);nextState()}}else startTime=t;return requestAnimationFrame(loop)}function changeState(t){var e=t.target;let a;switch(parseInt(e.value)){case 1:a=blinker.concat(glider);break;case 2:a=cross.concat(LWSS);break;case 3:a=all;break;default:a=schemas[e.value]}initState(a)}function randState(){select.children[0].removeAttribute("selected");var a=[];for(let e=0;e<state.length;e++){a[e]=[];for(let t=0;t<state.length;t++){var n=numFn.rand(100);a[e][t]=n<10}}state=a,select.children[0].setAttribute("selected",!0)}initState(galaxie),loop(),select.addEventListener("change",changeState),button.addEventListener("click",randState);