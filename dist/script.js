import{FetchFn,NumberFn}from"./scripts/lib.js";import{DomFn}from"./scripts/client.js";import{Cell}from"./Game.js";let domFn=new DomFn,fetchFn=new FetchFn,numFn=new NumberFn,select=domFn.select("aside > select"),button=domFn.select("aside > button"),canvas=domFn.select("canvas"),ctxt=canvas.getContext("2d"),width=(ctxt.size=100,canvas.width),height=canvas.height,schemas=await fetchFn.get(null,"json","/assets/GameSchemas.json"),{clignotant,croix,galaxie,planeur,LWSS}=schemas,all=[...clignotant,...croix,...galaxie,...planeur,...LWSS],state,startTime;function initState(t=[]){state=[];for(let e=0;e<ctxt.size;e++){state.push([]);for(let t=0;t<ctxt.size;t++)state[e][t]=new Cell(t,e)}t.forEach(t=>{state[t[1]][t[0]].live=!0})}function drawGrid(){ctxt.strokeStyle="white";for(let t=0,e=-ctxt.size;e<ctxt.size;t++,e++){var a;0<=e?(a=width/ctxt.size,ctxt.beginPath(),ctxt.moveTo(e*a,0),ctxt.lineTo(e*a,height)):(a=height/ctxt.size,ctxt.beginPath(),ctxt.moveTo(0,t*a),ctxt.lineTo(width,t*a)),ctxt.stroke(),ctxt.closePath()}}function nextState(){var a=[];for(let e=0;e<state.length;e++){a.push([]);for(let t=0;t<state.length;t++)switch(a[e][t]=new Cell(t,e),a[e][t].live=state[e][t].live,[state[e-1]?state[e-1][t-1]:null,state[e][t-1],state[e+1]?state[e+1][t-1]:null,state[e-1]?state[e-1][t]:null,state[e+1]?state[e+1][t]:null,state[e-1]?state[e-1][t+1]:null,state[e][t+1],state[e+1]?state[e+1][t+1]:null].filter(t=>t&&t.live).length){case 3:a[e][t].live=!0;break;case 2:break;default:a[e][t].live=!1}}state=a}function clearCanvas(){var t=Math.max(width,height);ctxt.clearRect(-10,-10,t+20,t+20)}function loop(t){if(startTime){if(!(t<startTime+160)){startTime=t,clearCanvas();for(let e=0;e<state.length;e++)for(let t=0;t<state.length;t++)state[e][t].live&&state[e][t].draw(ctxt);nextState()}}else startTime=t;return requestAnimationFrame(loop)}function changeState(t){var e=t.target;let a;switch(parseInt(e.value)){case 1:a=clignotant.concat(planeur);break;case 2:a=croix.concat(LWSS);break;case 3:a=all;break;default:a=schemas[e.value]}initState(a)}function randState(){select.children[0].removeAttribute("selected");var a=[];for(let e=0;e<state.length;e++){a.push([]);for(let t=0;t<state.length;t++){var n=numFn.rand(100);a[e][t]=new Cell(t,e),a[e][t].live=n<10}}state=a,select.children[0].setAttribute("selected",!0)}initState(galaxie),loop(),select.addEventListener("change",changeState),button.addEventListener("click",randState);